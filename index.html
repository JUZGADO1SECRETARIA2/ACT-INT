<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Sentencias</title>
    
    <!-- React y ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tus estilos CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // Componente principal
        const SentenciaGenerator = () => {
            // Estados con React.useState
            const [tipoSentencia, setTipoSentencia] = React.useState("");
            const [fallecimiento, setFallecimiento] = React.useState({
                pensionada: false,
                herederos: false
            });
            const [integral, setIntegral] = React.useState({
                ansesreajusta: false,
                ansespagaretroactivo: false,
                nohaypagonireajuste: false
            });
            const [fechas, setFechas] = React.useState({
                inicio: '',
                final: '',
                liquidacion: ''
            });
            const [montos, setMontos] = React.useState({
                haber: '',
                retroactivo: '',
                capital: '',
                intereses: '',
                mensualDePago: '' 
            });
            const [honorarios, setHonorarios] = React.useState({
                umaspesos: '',
                umasequivalente: ''
            });
            
            // ===== TABLA DE PARÁMETROS UMA =====
            // Tabla PARAMETROS de Google Sheets (A2:D56)
            const TABLA_PARAMETROS = [
                { desde: '1899-12-31', hasta: '2017-12-31', valorUMA: 1350.00 },
                { desde: '2018-01-01', hasta: '2018-03-31', valorUMA: 1417.00 },
                { desde: '2018-04-01', hasta: '2018-07-31', valorUMA: 1559.00 },
                { desde: '2018-08-01', hasta: '2018-09-30', valorUMA: 1715.00 },
                { desde: '2018-10-01', hasta: '2019-02-28', valorUMA: 1887.00 },
                { desde: '2019-03-01', hasta: '2019-04-30', valorUMA: 2075.00 },
                { desde: '2019-05-01', hasta: '2019-05-31', valorUMA: 2231.00 },
                { desde: '2019-06-01', hasta: '2019-08-31', valorUMA: 2398.00 },
                { desde: '2019-09-01', hasta: '2019-10-31', valorUMA: 2638.00 },
                { desde: '2019-11-01', hasta: '2019-11-30', valorUMA: 2902.00 },
                { desde: '2019-12-01', hasta: '2020-09-30', valorUMA: 3192.00 },
                { desde: '2020-10-01', hasta: '2020-10-31', valorUMA: 3511.00 },
                { desde: '2020-11-01', hasta: '2020-11-30', valorUMA: 3862.00 },
                { desde: '2020-12-01', hasta: '2021-02-28', valorUMA: 4152.00 },
                { desde: '2021-03-01', hasta: '2021-05-31', valorUMA: 4567.00 },
                { desde: '2021-06-01', hasta: '2021-08-31', valorUMA: 4978.00 },
                { desde: '2021-09-01', hasta: '2021-10-31', valorUMA: 6160.00 },
                { desde: '2021-11-01', hasta: '2022-01-31', valorUMA: 6468.00 },
                { desde: '2022-02-01', hasta: '2022-03-31', valorUMA: 7439.00 },
                { desde: '2022-04-01', hasta: '2022-04-30', valorUMA: 8183.00 },
                { desde: '2022-05-01', hasta: '2022-06-30', valorUMA: 9001.00 },
                { desde: '2022-07-01', hasta: '2022-08-31', valorUMA: 9811.00 },
                { desde: '2022-09-01', hasta: '2022-11-30', valorUMA: 10400.00 },
                { desde: '2022-12-01', hasta: '2022-12-31', valorUMA: 12479.00 },
                { desde: '2023-03-01', hasta: '2023-03-31', valorUMA: 14933.00 },
                { desde: '2023-04-01', hasta: '2023-04-30', valorUMA: 16277.00 },
                { desde: '2023-05-01', hasta: '2023-05-31', valorUMA: 17741.00 },
                { desde: '2023-06-01', hasta: '2023-06-30', valorUMA: 19338.00 },
                { desde: '2023-07-01', hasta: '2023-07-31', valorUMA: 20595.00 },
                { desde: '2023-08-01', hasta: '2023-07-31', valorUMA: 23067.00 },
                { desde: '2023-09-01', hasta: '2023-09-30', valorUMA: 25373.00 },
                { desde: '2023-10-01', hasta: '2023-10-30', valorUMA: 27784.00 },
                { desde: '2023-11-01', hasta: '2023-11-30', valorUMA: 30562.00 },
                { desde: '2023-12-01', hasta: '2023-12-31', valorUMA: 34382.00 },
                { desde: '2024-01-01', hasta: '2024-01-31', valorUMA: 40571.00 },
                { desde: '2024-02-01', hasta: '2024-02-29', valorUMA: 45440.00 },
                { desde: '2024-03-01', hasta: '2024-03-31', valorUMA: 49075.00 },
                { desde: '2024-04-01', hasta: '2024-04-30', valorUMA: 52510.00 },
                { desde: '2024-05-01', hasta: '2024-05-31', valorUMA: 54716.00 },
                { desde: '2024-06-01', hasta: '2024-06-30', valorUMA: 57016.00 },
                { desde: '2024-07-01', hasta: '2024-07-31', valorUMA: 59009.00 },
                { desde: '2024-08-01', hasta: '2024-08-31', valorUMA: 60779.00 },
                { desde: '2024-09-01', hasta: '2024-09-30', valorUMA: 61995.00 },
                { desde: '2024-10-01', hasta: '2024-10-31', valorUMA: 63545.00 },
                { desde: '2024-11-01', hasta: '2024-11-30', valorUMA: 65133.00 },
                { desde: '2024-12-01', hasta: '2024-12-31', valorUMA: 66436.00 },
                { desde: '2025-01-01', hasta: '2025-01-31', valorUMA: 67632.00 },
                { desde: '2025-02-01', hasta: '2025-02-28', valorUMA: 68985.00 },
                { desde: '2025-03-01', hasta: '2025-03-31', valorUMA: 70709.00 },
                { desde: '2025-04-01', hasta: '2025-04-30', valorUMA: 72265.00 },
                { desde: '2025-05-01', hasta: '2025-05-31', valorUMA: 73204.00 },
                { desde: '2025-06-01', hasta: '2025-06-30', valorUMA: 74376.00 },
                { desde: '2025-07-01', hasta: '2025-07-31', valorUMA: 75789.00 },
                { desde: '2025-08-01', hasta: '2025-08-31', valorUMA: 77229.00 },
                { desde: '2025-09-01', hasta: '2025-09-30', valorUMA: 78850.00 },
                { desde: '2025-10-01', hasta: '2025-10-31', valorUMA: 80664.00 },
                { desde: '2025-11-01', hasta: '2025-12-31', valorUMA: 84963.00 },
                { desde: '2026-01-01', hasta: '2026-10-31', valorUMA: 87342.00 }
            ];
            
            const [calculandoHonorarios, setCalculandoHonorarios] = React.useState(false);
            const [umaActual, setUmaActual] = React.useState(null);
            
            // ===== TABLA DE PARÁMETROS DE HONORARIOS (F2:L8) =====
            // Estructura: [desde, hasta, porcentaje_minimo, porcentaje_medio, porcentaje_maximo, limite_grado_anterior, grado]
            const TABLA_PARAMETROS_HONORARIOS = [
                { desde: 0, hasta: 15, porcentajeMin: 0.22, porcentajeMedio: 0.33, porcentajeMax: null, limiteGradoAnterior: null, grado: '1º' },
                { desde: 16, hasta: 45, porcentajeMin: 0.20, porcentajeMedio: 0.26, porcentajeMax: 0.33, limiteGradoAnterior: 15, grado: '2º' },
                { desde: 46, hasta: 90, porcentajeMin: 0.18, porcentajeMedio: 0.24, porcentajeMax: 0.26, limiteGradoAnterior: 45, grado: '3º' },
                { desde: 91, hasta: 150, porcentajeMin: 0.17, porcentajeMedio: 0.22, porcentajeMax: 0.24, limiteGradoAnterior: 90, grado: '4º' },
                { desde: 151, hasta: 450, porcentajeMin: 0.15, porcentajeMedio: 0.20, porcentajeMax: 0.22, limiteGradoAnterior: 150, grado: '5º' },
                { desde: 451, hasta: 750, porcentajeMin: 0.13, porcentajeMedio: 0.17, porcentajeMax: 0.20, limiteGradoAnterior: 450, grado: '6º' },
                { desde: 751, hasta: null, porcentajeMin: 0.12, porcentajeMedio: 0.15, porcentajeMax: 0.17, limiteGradoAnterior: 750, grado: '7º' }
            ];
            
            // Función para buscar en la tabla PARAMETROS usando VLOOKUP
            // Busca el valor c9 en el rango [desde, hasta] y devuelve la columna especificada
            const buscarEnParametros = (c9, columna) => {
                // Buscar el rango que contiene c9
                for (let i = TABLA_PARAMETROS_HONORARIOS.length - 1; i >= 0; i--) {
                    const fila = TABLA_PARAMETROS_HONORARIOS[i];
                    const desde = fila.desde;
                    const hasta = fila.hasta === null ? Infinity : fila.hasta;
                    
                    if (c9 >= desde && c9 <= hasta) {
                        // Columna 1 = desde (F)
                        // Columna 2 = hasta (G)
                        // Columna 3 = porcentaje mínimo (H)
                        // Columna 4 = porcentaje medio (I)
                        // Columna 5 = porcentaje máximo (J)
                        // Columna 6 = límite grado anterior (K)
                        // Columna 7 = grado (L)
                        const valores = [
                            fila.desde,
                            fila.hasta,
                            fila.porcentajeMin,
                            fila.porcentajeMedio,
                            fila.porcentajeMax,
                            fila.limiteGradoAnterior,
                            fila.grado
                        ];
                        return valores[columna - 1]; // columna es 1-indexed
                    }
                }
                // Si no se encuentra, devolver el primer valor (grado 1)
                const primeraFila = TABLA_PARAMETROS_HONORARIOS[0];
                const valores = [primeraFila.desde, primeraFila.hasta, primeraFila.porcentajeMin, primeraFila.porcentajeMedio, primeraFila.porcentajeMax, primeraFila.limiteGradoAnterior, primeraFila.grado];
                return valores[columna - 1];
            };
            
            // Función BUSCARV: Busca una fecha en la tabla de parámetros y devuelve el valor UMA
            // Equivalente a BUSCARV($J$11;PARAMETROS!A2:D80;3)
            const buscarVUMA = (fechaStr) => {
                console.log('buscarVUMA - fechaStr:', fechaStr);
                
                if (!fechaStr) {
                    console.error('Fecha vacía en buscarVUMA');
                    return TABLA_PARAMETROS[TABLA_PARAMETROS.length - 1].valorUMA;
                }
                
                // Convertir fecha de formato YYYY-MM-DD a Date
                // Agregar hora para evitar problemas de zona horaria
                const fechaBuscar = new Date(fechaStr + 'T12:00:00');
                
                if (isNaN(fechaBuscar.getTime())) {
                    console.error('Fecha inválida:', fechaStr);
                    return TABLA_PARAMETROS[TABLA_PARAMETROS.length - 1].valorUMA;
                }
                
                console.log('Fecha buscada (Date):', fechaBuscar);
                
                // Buscar en la tabla el rango que contiene la fecha
                for (let i = TABLA_PARAMETROS.length - 1; i >= 0; i--) {
                    const fila = TABLA_PARAMETROS[i];
                    const desde = new Date(fila.desde + 'T00:00:00');
                    const hasta = new Date(fila.hasta + 'T23:59:59');
                    
                    // Si la fecha está en el rango [desde, hasta]
                    if (fechaBuscar >= desde && fechaBuscar <= hasta) {
                        console.log('UMA encontrada para fecha:', fechaStr, '->', fila.valorUMA);
                        return fila.valorUMA;
                    }
                }
                
                // Si no se encuentra, devolver el último valor (más reciente)
                console.warn('No se encontró UMA para la fecha:', fechaStr, '- usando la más reciente');
                return TABLA_PARAMETROS[TABLA_PARAMETROS.length - 1].valorUMA;
            };
            
            // Función para calcular honorarios usando las fórmulas EXACTAS de Google Sheets
            const calcularHonorariosLocalmente = (montoTotal, fechaCierre, fechaCierreUMA) => {
                console.log('calcularHonorariosLocalmente - montoTotal:', montoTotal, 'fechaCierre:', fechaCierre, 'fechaCierreUMA:', fechaCierreUMA);
                
                // Validar que tengamos los datos necesarios
                if (!montoTotal || !fechaCierre) {
                    console.error('Faltan datos: montoTotal o fechaCierre');
                    return { success: false, error: 'Faltan datos para calcular honorarios' };
                }
                
                // C8 = BUSCARV($J$11;PARAMETROS!A2:D80;3)
                const c8 = buscarVUMA(fechaCierre);
                console.log('C8 (UMA para cálculo, fecha:', fechaCierre, '):', c8);
                
                // C10 = BUSCARV($J$12;PARAMETROS!A2:D100;3)
                const fechaParaC10 = fechaCierreUMA || fechaCierre;
                const c10 = buscarVUMA(fechaParaC10);
                console.log('C10 (UMA actual, fecha:', fechaParaC10, '):', c10);
                
                if (!c8 || !c10 || c8 === 0 || c10 === 0) {
                    console.error('No se encontró UMA para la fecha:', fechaCierre);
                    return { success: false, error: 'No se encontró UMA para la fecha de liquidación' };
                }
                
                // Limpiar el monto
                const montoLimpio = parseFloat(
                    montoTotal.toString()
                        .trim()
                        .replace(/\s/g, '')
                        .replace(/\./g, '')
                        .replace(',', '.')
                );
                
                console.log('Monto limpio (J10):', montoLimpio);
                
                if (isNaN(montoLimpio) || montoLimpio === 0) {
                    console.error('Monto no válido después de parsear:', montoTotal);
                    return { success: false, error: 'Monto no válido' };
                }
                
                // C9 = J10/C8 (monto en UMAs)
                const c9 = montoLimpio / c8;
                console.log('C9 (monto en UMAs):', c9);
                
                // Buscar en PARAMETROS usando C9
                // Nota: VLOOKUP cuenta columnas desde la primera columna del rango (F)
                // PARAMETROS!F2:J8 = columnas F,G,H,I,J (5 columnas)
                // PARAMETROS!F2:K8 = columnas F,G,H,I,J,K (6 columnas)
                // PARAMETROS!F2:I8 = columnas F,G,H,I (4 columnas)
                
                // C13 = VLOOKUP(C9; PARAMETROS!F2:J8; 5) - columna 5 desde F = J (porcentaje máximo)
                const porcentajeMaximo = buscarEnParametros(c9, 5); // Columna 5 desde F = J (porcentaje máximo)
                const c13 = porcentajeMaximo;
                console.log('C13 (porcentaje máximo):', c13);
                
                // F13 = VLOOKUP(C9; PARAMETROS!F2:K8; 6)*C13 - columna 6 desde F = K (límite grado anterior)
                const limiteGradoAnterior = buscarEnParametros(c9, 6); // Columna 6 desde F = K (límite grado anterior)
                
                // Si estamos en grado 1º (c9 <= 15), límite grado anterior es null
                // En ese caso, F13 se calcula de manera diferente
                let f13;
                if (limiteGradoAnterior === null) {
                    // Para grado 1º: F13 = C9 * porcentaje máximo (pero porcentaje máximo también es null)
                    // Parece que para grado 1º, usamos el porcentaje medio
                    const porcentajeMedio = buscarEnParametros(c9, 4); // Columna 4 = I (porcentaje medio)
                    f13 = c9 * porcentajeMedio;
                } else {
                    f13 = limiteGradoAnterior * c13;
                }
                console.log('F13 (UMAs límite grado anterior):', f13);
                
                // D13 = F13*C8
                const d13 = f13 * c8;
                console.log('D13 (monto límite grado anterior):', d13);
                
                // C14 = VLOOKUP(C9; PARAMETROS!F2:I8; 3) - columna 3 desde F = H (porcentaje mínimo)
                const c14 = buscarEnParametros(c9, 3); // Columna 3 desde F = H (porcentaje mínimo)
                console.log('C14 (porcentaje mínimo):', c14);
                
                // F14 = (C9 - VLOOKUP(C9; PARAMETROS!F2:K8; 6))*C14
                // VLOOKUP(C9; PARAMETROS!F2:K8; 6) = límite grado anterior (columna K)
                // Si estamos en grado 1º, no hay límite grado anterior, entonces el excedente es C9
                let excedenteUMAs;
                if (limiteGradoAnterior === null) {
                    excedenteUMAs = 0; // No hay excedente en grado 1º
                } else {
                    excedenteUMAs = Math.max(0, c9 - limiteGradoAnterior);
                }
                const f14 = excedenteUMAs * c14;
                console.log('F14 (excedente * porcentaje mínimo):', f14);
                
                // D14 = F14*C8
                const d14 = f14 * c8;
                console.log('D14 (monto excedente):', d14);
                
                // D18 = ((D13+D14)/2)*(IF(K6=FALSE;0,9;1))
                // Asumimos K6=FALSE (ausencia de excepciones) por defecto, así que multiplicamos por 0.9
                const k6 = false; // TODO: esto debería venir de un campo del formulario
                const factorK6 = k6 ? 1 : 0.9;
                const d18 = ((d13 + d14) / 2) * factorK6;
                console.log('D18 (monto ajustado):', d18);
                
                // F18 = D18/C8
                const f18 = d18 / c8;
                console.log('F18 (monto ajustado en UMAs):', f18);
                
                // J20 = REDONDEAR(F18 / 2)
                const j20 = Math.round(f18 / 2);
                console.log('J20 (cantidad de UMAs):', j20);
                
                // K20 = J20 * C10
                const k20 = j20 * c10;
                console.log('K20 (UMAs en pesos):', k20);
                
                // Validar que los resultados sean números válidos
                if (isNaN(j20) || isNaN(k20) || j20 < 0 || k20 < 0) {
                    console.error('Resultados inválidos:', { j20, k20, c8, c10, f18 });
                    return { success: false, error: 'Resultados del cálculo inválidos' };
                }
                
                // Guardar UMA actual para mostrarla
                setUmaActual(c10);
                
                console.log('Resultado final calculado:', { umasCantidad: j20, umasPesos: k20 });
                
                return {
                    success: true,
                    umasCantidad: j20,
                    umasPesos: k20
                };
            };
            
            // FUNCIÓN PARA CALCULAR HONORARIOS AUTOMÁTICAMENTE
            const calcularHonorarios = async () => {
                const montoTotal = montos.retroactivo; // Va a celda D18 (equivalente a J10)
                const fechaCierre = fechas.final; // Va a celda J11 (fecha de cierre de liquidación = fecha final)
                
                // J12 (C10) debe usar la fecha actual (hoy) para buscar la última UMA disponible
                const hoy = new Date();
                const fechaRegulacion = hoy.toISOString().split('T')[0]; // Formato YYYY-MM-DD
                
                if (!montoTotal || !fechaCierre) {
                    console.log('Faltan datos para calcular honorarios');
                    return null;
                }
                
                console.log('Calcular honorarios - montoTotal:', montoTotal, 'fechaCierre (final):', fechaCierre, 'fechaRegulacion (hoy):', fechaRegulacion);
                
                setCalculandoHonorarios(true);
                
                try {
                    const resultado = calcularHonorariosLocalmente(montoTotal, fechaCierre, fechaRegulacion);
                    
                    if (resultado.success) {
                        // Guardar los valores numéricos originales (sin formatear) para los cálculos
                        // El formateo solo se hará al generar el texto final
                        const honorariosParaEstado = {
                            umaspesos: resultado.umasPesos.toString(),
                            umasequivalente: resultado.umasCantidad.toString()
                        };
                        
                        // Actualizar estado para mostrar en la UI
                        setHonorarios(honorariosParaEstado);
                        console.log('Honorarios calculados correctamente:', resultado);
                        
                        // Devolver los valores numéricos originales (sin formatear)
                        return {
                            umaspesos: resultado.umasPesos,
                            umasequivalente: resultado.umasCantidad
                        };
                    } else {
                        alert('Error al calcular honorarios: ' + (resultado.error || 'Error desconocido'));
                        return null;
                    }
                } catch (error) {
                    console.error('Error al calcular honorarios:', error);
                    alert('Error al calcular honorarios: ' + error.message);
                    return null;
                } finally {
                    setCalculandoHonorarios(false);
                }
            };
            // ===== FIN DEL CÓDIGO DE CÁLCULO DE HONORARIOS =====
            
            const [tipoInteres, setTipoInteres] = React.useState('');
            const [ansesImpugno, setAnsesImpugno] = React.useState(false);
            const [ansesPresentoLiquidacion, setAnsesPresentoLiquidacion] = React.useState(true);
            const [impugnaciones, setImpugnaciones] = React.useState({
                a: false,
                b: false,
                c: false,
                d: false,
                e: false,
                f: false,
                g: false,
                h: false,
                i: false
            });
            const [generado, setGenerado] = React.useState('');
            const [modoNumerosALetras, setModoNumerosALetras] = React.useState(false);
            const [mostrarHonorariosEnModoLetras, setMostrarHonorariosEnModoLetras] = React.useState(false);
            // Funciones auxiliares
            const formatearFecha = (fecha) => {
                if (!fecha) return '';
                const [year, month, day] = fecha.split('-');
                return `${day}/${month}/${year}`;
            };
            const handleMontoChange = (e, campo) => {
                const valor = e.target.value;
                setMontos(prev => {
                    const nuevoEstado = {...prev, [campo]: valor};
                    
                    if (campo === 'capital' || campo === 'intereses') {
                        const capital = parseFloat(nuevoEstado.capital.replace(/\./g, '').replace(',', '.')) || 0;
                        const intereses = parseFloat(nuevoEstado.intereses.replace(/\./g, '').replace(',', '.')) || 0;
                        const retroactivo = capital + intereses;
                        nuevoEstado.retroactivo = new Intl.NumberFormat('es-AR', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        }).format(retroactivo);
                    }
                    
                    return nuevoEstado;
                });
            };
            // Función para formatear montos en pesos SIN centavos (solo miles)
            const formatearPesosSinCentavos = (valor) => {
                if (!valor) return '0';
                const numeroLimpio = valor.toString()
                    .replace(/\./g, '')
                    .replace(',', '.');
                const numero = parseFloat(numeroLimpio);
                // Redondear a entero (sin decimales)
                const numeroEntero = Math.round(numero);
                // Formatear con separador de miles pero sin decimales
                return new Intl.NumberFormat('es-AR', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(numeroEntero);
            };
            const formatearMonto = (valor) => {
                if (!valor) return '0,00';
                const numeroLimpio = valor.toString()
                    .replace(/\./g, '')
                    .replace(',', '.');
                const numero = parseFloat(numeroLimpio);
                return new Intl.NumberFormat('es-AR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(numero);
            };
            const numeroALetras = (numero) => {
                const unidades = ['', 'UN', 'DOS', 'TRES', 'CUATRO', 'CINCO', 'SEIS', 'SIETE', 'OCHO', 'NUEVE'];
                const unidadesEspeciales = ['', 'UNO', 'DOS', 'TRES', 'CUATRO', 'CINCO', 'SEIS', 'SIETE', 'OCHO', 'NUEVE'];
                const decenas = ['', 'DIEZ', 'VEINTE', 'TREINTA', 'CUARENTA', 'CINCUENTA', 'SESENTA', 'SETENTA', 'OCHENTA', 'NOVENTA'];
                const especiales = {
                    11: 'ONCE', 12: 'DOCE', 13: 'TRECE', 14: 'CATORCE', 15: 'QUINCE',
                    16: 'DIECISEIS', 17: 'DIECISIETE', 18: 'DIECIOCHO', 19: 'DIECINUEVE',
                    21: 'VEINTIUN', 22: 'VEINTIDOS', 23: 'VEINTITRES', 24: 'VEINTICUATRO',
                    25: 'VEINTICINCO', 26: 'VEINTISEIS', 27: 'VEINTISIETE', 28: 'VEINTIOCHO',
                    29: 'VEINTINUEVE'
                };
                const convertirGrupo = (n, final = false) => {
                    let resultado = '';
                    
                    const centenas = Math.floor(n / 100);
                    if (centenas === 1) resultado += n === 100 ? 'CIEN ' : 'CIENTO ';
                    else if (centenas === 5) resultado += 'QUINIENTOS ';
                    else if (centenas === 7) resultado += 'SETECIENTOS ';
                    else if (centenas === 9) resultado += 'NOVECIENTOS ';
                    else if (centenas > 0) resultado += unidades[centenas] + 'CIENTOS ';
                    
                    const decena = n % 100;
                    if (decena > 0) {
                        if (especiales[decena]) {
                            resultado += especiales[decena];
                        } else {
                            const unidad = decena % 10;
                            const dec = Math.floor(decena / 10);
                            if (dec > 0) {
                                resultado += decenas[dec];
                                if (unidad > 0) resultado += ' Y ' + (final ? unidadesEspeciales[unidad] : unidades[unidad]);
                            } else if (unidad > 0) {
                                resultado += (final ? unidadesEspeciales[unidad] : unidades[unidad]);
                            }
                        }
                    }
                    
                    return resultado.trim();
                };
                if (!numero) return 'CERO CON CERO CENTAVOS';
                
                let numeroStr = numero.toString()
                    .replace(/\./g, '')
                    .replace(',', '.');
                let partes = parseFloat(numeroStr).toFixed(2).split('.');
                let entero = parseInt(partes[0]);
                let decimal = parseInt(partes[1]);
                
                let resultado = '';
                
                if (entero === 0) {
                    resultado = 'CERO';
                } else {
                    const millones = Math.floor(entero / 1000000);
                    if (millones > 0) {
                        resultado += convertirGrupo(millones);
                        resultado += millones === 1 ? ' MILLÓN ' : ' MILLONES ';
                    }
                    
                    const miles = Math.floor((entero % 1000000) / 1000);
                    if (miles > 0) {
                        resultado += convertirGrupo(miles) + ' MIL ';
                    }
                    
                    const resto = entero % 1000;
                    if (resto > 0) {
                        resultado += convertirGrupo(resto, true);
                    }
                }
                
                if (decimal > 0) {
                    if (decimal === 1) {
                        resultado += ' CON UN CENTAVO';
                    } else {
                        resultado += ' CON ' + convertirGrupo(decimal) + ' CENTAVOS';
                    }
                } else {
                    resultado += ' CON CERO CENTAVOS';
                }
                
                return 'PESOS ' + resultado.trim();
            };
            const handleHonorariosChange = (e, campo) => {
                const valor = e.target.value;
                setHonorarios(prev => {
                    const nuevoEstado = {...prev, [campo]: valor};
                    return nuevoEstado;
                });
            };
            const handleFechaChange = (e, campo) => {
                setFechas(prev => ({...prev, [campo]: e.target.value}));
            };
            const generarListaImpugnaciones = () => {
                const mapImpugnaciones = {
                    a: "que las fechas de inicio y de corte para el cálculo de los intereses son incorrectas",
                    b: "que la movilidad del fallo Badaro no ha sido correctamente aplicada",
                    c: "que el reajuste de la PBU es incorrecto",
                    d: "que la tasa de interés aplicada es incorrecta",
                    e: "que los haberes percibidos son incorrectos",
                    f: "que la forma de descontar los pagos es incorrecta",
                    g: "que se liberan los topes legales",
                    h: "que no se aplica el precedente Villanustre",
                    i: "que no se informa el cálculo correspondiente a la retención del Impuesto a las Ganancias conforme a la Ley Nº 20.628"
                };
                const impugnacionesActivas = Object.entries(impugnaciones)
                    .filter(([_, v]) => v)
                    .map(([k]) => mapImpugnaciones[k]);
                if (impugnacionesActivas.length === 0) return "";
                if (impugnacionesActivas.length === 1) return impugnacionesActivas[0];
                return impugnacionesActivas.slice(0, -1).join(", ") + ", y " + impugnacionesActivas[impugnacionesActivas.length - 1];
            };
            const generarTexto = async () => {
                // Modo "Números a letras": solo montos en letras y honorarios (si el usuario los calculó o ingresó)
                if (modoNumerosALetras) {
                    const lineas = [];
                    if (montos.retroactivo) {
                        lineas.push(`Retroactivo: $ ${formatearMonto(montos.retroactivo)}\n${numeroALetras(montos.retroactivo)}`);
                    }
                    if (montos.capital) {
                        lineas.push(`Capital: $ ${formatearMonto(montos.capital)}\n${numeroALetras(montos.capital)}`);
                    }
                    if (montos.intereses) {
                        lineas.push(`Intereses: $ ${formatearMonto(montos.intereses)}\n${numeroALetras(montos.intereses)}`);
                    }
                    const honorariosVacios = !honorarios.umaspesos || !honorarios.umasequivalente || honorarios.umaspesos.trim() === '' || honorarios.umasequivalente.trim() === '';
                    if (!honorariosVacios) {
                        lineas.push(`Honorarios: $ ${formatearPesosSinCentavos(honorarios.umaspesos)} (${honorarios.umasequivalente.trim()} UMAS)`);
                    } else if (fechas.final && montos.retroactivo) {
                        const res = await calcularHonorarios();
                        if (res && res.umaspesos != null && res.umasequivalente != null) {
                            setHonorarios({ umaspesos: res.umaspesos.toString(), umasequivalente: res.umasequivalente.toString() });
                            lineas.push(`Honorarios: $ ${formatearPesosSinCentavos(res.umaspesos.toString())} (${Math.round(res.umasequivalente)} UMAS)`);
                        }
                    }
                    setGenerado(lineas.join('\n\n'));
                    return;
                }
                
                // Determinar si necesitamos calcular honorarios
                // Solo calcular si los campos están vacíos
                const camposVacios = !honorarios.umaspesos || !honorarios.umasequivalente || 
                                    honorarios.umaspesos.trim() === '' || honorarios.umasequivalente.trim() === '';
                
                let honorariosCalculados = honorarios; // Por defecto usar los del estado
                
                // Solo calcular automáticamente si los campos están vacíos
                if (camposVacios) {
                    // Validar que existan los datos necesarios para calcular
                    // J11 (C8) usa fechas.final (fecha de cierre de liquidación)
                    // J12 (C10) usa la fecha actual (hoy) - se calcula automáticamente
                    if (!montos.retroactivo || !fechas.final) {
                        const mensaje = !montos.retroactivo 
                            ? 'Por favor ingresa el monto retroactivo para calcular los honorarios automáticamente.'
                            : 'Por favor ingresa la fecha final (fecha de cierre de liquidación) para calcular los honorarios automáticamente.';
                        
                        alert(mensaje);
                        console.warn('No se pueden calcular honorarios - faltan datos:', { retroactivo: montos.retroactivo, final: fechas.final });
                    } else {
                        console.log('Campos de honorarios vacíos - calculando automáticamente con:', { retroactivo: montos.retroactivo, final: fechas.final });
                        const honorariosTemp = await calcularHonorarios();
                        console.log('Honorarios calculados en generarTexto:', honorariosTemp);
                        if (honorariosTemp && honorariosTemp.umaspesos !== undefined && honorariosTemp.umasequivalente !== undefined) {
                            honorariosCalculados = {
                                umaspesos: honorariosTemp.umaspesos,
                                umasequivalente: honorariosTemp.umasequivalente
                            };
                            console.log('Usando honorarios calculados automáticamente:', honorariosCalculados);
                        } else {
                            console.warn('No se pudieron calcular honorarios o están vacíos. Usando valores del estado:', honorarios);
                            if (!honorariosTemp) {
                                alert('Error al calcular los honorarios automáticamente. Por favor verifica que el monto y la fecha final sean correctos, o ingresa los valores manualmente.');
                            }
                        }
                    }
                } else {
                    console.log('Usando valores de honorarios ingresados manualmente:', honorarios);
                    // Si el usuario ingresó valores manualmente, convertir a números para el formateo final
                    const umasPesosNum = parseFloat(honorarios.umaspesos.toString().replace(/\./g, '').replace(',', '.')) || 0;
                    const umasEquivNum = parseFloat(honorarios.umasequivalente.toString().replace(/\./g, '').replace(',', '.')) || 0;
                    honorariosCalculados = {
                        umaspesos: umasPesosNum,
                        umasequivalente: umasEquivNum
                    };
                }
                
                // Formatear solo para mostrar en el texto (sin afectar el cálculo)
                const honorariosParaTexto = {
                    umaspesos: formatearPesosSinCentavos(honorariosCalculados.umaspesos.toString()),
                    umasequivalente: Math.round(honorariosCalculados.umasequivalente).toString()
                };
                
                console.log('Honorarios a usar en el texto:', honorariosParaTexto);
                
                const parrafos = [];
                if (fallecimiento.pensionada) {
                    parrafos.push("En primer lugar, corresponde señalar que se ha denunciado el fallecimiento del causante y se ha presentado la pensionada.");
                    parrafos.push("Que en las presentes actuaciones se aprobó liquidación y se mandó llevar adelante la ejecución, se trabó embargo por las sumas resultantes de dicho cálculo y se ordenó su transferencia a la cuenta de la actora.");
                } else if (fallecimiento.herederos) {
                    parrafos.push("En primer lugar, corresponde señalar que se ha denunciado el fallecimiento del causante y se han presentado los herederos.");
                    parrafos.push("Que en las presentes actuaciones se aprobó liquidación y se mandó llevar adelante la ejecución, se trabó embargo por las sumas resultantes de dicho cálculo y se ordenó su transferencia a la cuenta de la actora.");
                } else {
                    parrafos.push("Que en las presentes actuaciones se aprobó liquidación y se mandó llevar adelante la ejecución, se trabó embargo por las sumas resultantes de dicho cálculo y se ordenó su transferencia a la cuenta de la actora.");
                }
                if (!integral.ansesreajusta) {
                    parrafos.push(`Persistiendo el incumplimiento por parte de la demandada, la parte actora acompaña una nueva liquidación por las diferencias pendientes de pago devengadas entre el ${formatearFecha(fechas.inicio)} y ${formatearFecha(fechas.final)}.`);
                }
                if (integral.ansesreajusta) {
                    parrafos.push(`Que en el mensual ${montos.mensualDePago} la Anses reajustó el haber del actor pero no abonó sumas en concepto de retroactivo. Ante el cumplimiento parcial de la ejecutada, la actora practica liquidación por las diferencias pendientes de pago entre el ${formatearFecha(fechas.inicio)} y ${formatearFecha(fechas.final)}.`);
                }
                if (integral.ansespagaretroactivo) {
                    parrafos.push("Que atento al cumplimiento parcial por parte de la demandada, la actora practica una nueva liquidación integral, descontando las sumas percibidas en autos mediante embargo y las abonadas por la Anses en el mensual 0000000.");
                }
                if (integral.nohaypagonireajuste) {
                    parrafos.push(`Persistiendo el incumplimiento por parte de la demandada, la parte actora acompaña una nueva liquidación integral en fecha ${formatearFecha(fechas.liquidacion)}, procediendo a descontar las sumas percibidas mediante embargo.`);
                }
                const tiposInteresParrafos = {
                    corteEmbargo: "Asimismo, calcula los intereses desde la fecha de corte del último cómputo aprobado, hasta la efectivización del embargo decretado en autos.",
                    corteTransferencia: "Asimismo, calcula los intereses desde la fecha de corte del último cómputo aprobado, hasta la efectivización de la transferencia de las sumas embargadas.",
                    intimacionEmbargo: "Asimismo, calcula los intereses desde la fecha de vencimiento de la intimación al pago del último cómputo aprobado, hasta la efectivización del embargo decretado en autos.",
                    intimacionTransferencia: "Asimismo, calcula los intereses desde la fecha de vencimiento de la intimación al pago del último cómputo aprobado, hasta la efectivización de la transferencia de las sumas embargadas."
                };
                if (tipoInteres && tiposInteresParrafos[tipoInteres]) {
                    parrafos.push(tiposInteresParrafos[tipoInteres]);
                }
                if (ansesImpugno) {
                    parrafos.push(`Corrido el pertinente traslado, la Anses impugna dicha liquidación, aduciendo ${generarListaImpugnaciones()}.`);
                    parrafos.push("La parte actora contesta el traslado conferido y solicita que se rechacen las impugnaciones de la ejecutada, por los fundamentos allí expuestos a los que me remito en honor a la brevedad, y que se apruebe la liquidación por ella practicada.");
                    if (integral.ansesreajusta) {
                        parrafos.push("Ahora bien, en cuanto al haber reajustado por el organismo, se verifica que resulta idéntico al liquidado por la actora por lo que corresponde tener por cumplido el reclamo en tal sentido.");
                    }
                    if (impugnaciones.a) {
                        if (tipoInteres === 'corteEmbargo') {
                            parrafos.push('En torno al cálculo de intereses efectuado por la actora desde la fecha de corte del último cómputo aprobado, cabe puntualizar que la Suscripta comparte el criterio sustentado por la Sala I de la CFSS en la causa "FREUND JORGE CARLOS c/anses s/ otros - ejecución previsional" de fecha 25/11/2019 exp. 15156/12, donde sostuvo que "...la Tasa Pasiva para Uso de la Justicia (Com. A 14.290 BCRA) tiene implícita la capitalización en su fórmula de cálculo, aplicarla a un importe compuesto de capital e intereses no produce anatocismo...". En consecuencia, corresponde rechazar el planteo de la Anses en tal sentido.');
                        } else if (tipoInteres === 'corteTransferencia') {
                            parrafos.push('En torno al cálculo de intereses efectuado por la actora desde la fecha de corte del último cómputo aprobado, cabe puntualizar que la Suscripta comparte el criterio sustentado por la Sala I de la CFSS en la causa "FREUND JORGE CARLOS c/anses s/ otros - ejecución previsional" de fecha 25/11/2019 exp. 15156/12, donde sostuvo que "...la Tasa Pasiva para Uso de la Justicia (Com. A 14.290 BCRA) tiene implícita la capitalización en su fórmula de cálculo, aplicarla a un importe compuesto de capital e intereses no produce anatocismo...". En consecuencia, corresponde rechazar el planteo de la Anses en tal sentido. Asimismo, observo que ha calculado los intereses hasta la fecha de efectivización de la transferencia del importe embargado, a la cuenta de titularidad del actor. (Conf. "Dietl Enrique Arturo c/Anses s/ Amparos y Sumarisimos, CFSS, Sala II del 24.10.18), por lo que corresponde desestimar los cuestionamientos.');
                        } else if (tipoInteres === 'intimacionEmbargo') {
                            parrafos.push('En cuanto al cálculo de intereses, observo que ha sido practicado de conformidad a lo dispuesto por el art. 770 inc. c del CCCN, por lo que corresponde desestimar los cuestionamientos.');
                        } else if (tipoInteres === 'intimacionTransferencia') {
                            parrafos.push('En cuanto al cálculo de intereses, observo que ha sido practicado de conformidad a lo dispuesto por el art. 770 inc.c del CCCN y hasta la fecha de efectivización de la transferencia del importe embargado, a la cuenta de titularidad del actor. (Conf. "Dietl Enrique Arturo c/Anses s/ Amparos y Sumarisimos, CFSS, Sala II del 24.10.18), por lo que corresponde desestimar los cuestionamientos.');
                        }
                    }
                    if (impugnaciones.d) {
                        parrafos.push("Asimismo, observo que la actora aplica la tasa de interés ordenada en la Sentencia que se ejecuta, por lo que corresponde desestimar la impugnación en tal sentido.");
                    }
                    if (impugnaciones.e) {
                        parrafos.push("Ahora bien, en cuanto a los haberes percibidos, toda vez que los mismos coinciden en su totalidad con los que surgen de la página web de Anses, corresponde sin más desestimar la impugnación.");
                    }
                    if (impugnaciones.f) {
                        parrafos.push("Ahora bien, en cuanto a la forma de descontar los pagos efectuados, toda vez que la parte actora los deduce correctamente, corresponde sin más desestimar la impugnación.");
                    }
                    if (impugnaciones.i) {
                        parrafos.push("Ahora bien, toda vez que la cuestión relativa a la aplicación del impuesto a las ganancias ya ha sido resuelta oportunamente en autos, corresponde sin más desestimar la impugnación.");
                    }
                    if (impugnaciones.b || impugnaciones.c || impugnaciones.g || impugnaciones.h) {
                        parrafos.push("Con respecto a las restantes impugnaciones, toda vez que la presente se trata de una liquidación ampliatoria, y que al haber aprobado oportunamente se le aplican únicamente los índices de movilidad dispuestos por ley, a las impugnaciones no ha lugar.");
                    }
                } else {
                    parrafos.push("Corrido el pertinente traslado, la Anses, se mantiene silente.");
                    parrafos.push("La parte actora solicita se apruebe la liquidación por ella practicada.");
                }
                if (!ansesPresentoLiquidacion) {
                    parrafos.push('Cabe recordar además, que la impugnación de la liquidación en forma genérica, sin especificación de lo que se considera desacertado: ni en el aspecto aritmético, ni en lo atinente a las demás cuestiones fácticas o jurídicas, es desestimable porque en tales condiciones, carece de fundamento susceptible de ponderación. La impugnación, para ser examinable, requiere el suministro de los cálculos correctos y de cuya comparación surgiría el error. (En el mismo sentido Cámara Comercial Sala C "Acrílicos Salerno S.A. s/ concurso s/ incid. de verificación, 31/8/89; Cámara Comercial Sala B "Curtarsa curtiembre Argentina S.A. c/ Lekeitto S.A., 18/10/88).');
                }
                parrafos.push("Así, luego de analizar la liquidación en cuestión y teniendo en cuenta que la misma se ajusta a los parámetros de la sentencia en ejecución, estimo acertado aprobarla.");
                parrafos.push('Respecto a la regulación de honorarios, se hará teniendo en cuenta lo establecido por la ley arancelaria N° 27.423, aplicable al caso de autos, conforme con lo resuelto por la Corte Suprema de Justicia de la Nación en el fallo "Establecimientos Las Marías S.A.C.I.F.A. c/Misiones Provincia de s/ acción Declarativa c/Buenos Aires, provincia de S/Daños y Perjuicios" del 4/09/18, el resultado y naturaleza del proceso, complejidad del asunto y la calidad e importancia de la tarea cumplida.');
                parrafos.push('Atento al tiempo transcurrido desde la presentación del cálculo en análisis, a fin de establecer la base regulatoria en UMAS prevista por la ley 27423, se considerará el valor de dicha unidad a la fecha de cierre de la liquidación (conf. Sala II CFSS expte N° 48840/2007 "SAGO HADEL ILANCO c/ ANSES s/REAJUSTES VARIOS" y expte. N° 31205/2012 "ALDANA JULIA c/ ANSES s/REAJUSTES VARIOS" Sent. Int. 16.08.2023).');
                parrafos.push("En consecuencia, RESUELVO:");
                if (integral.ansesreajusta) {
                    parrafos.push("1.- Tener cumplido el objeto de autos respecto del reajuste del haber.");
                    parrafos.push(`2.- Aprobar en cuanto ha lugar por derecho la liquidación presentada por la actora con fecha ${formatearFecha(fechas.liquidacion)}, quedando determinadas las retroactividades en ${numeroALetras(montos.retroactivo)} ($ ${formatearMonto(montos.retroactivo)}).`);
                    parrafos.push("3.- Intimar a la demandada para que en el plazo de diez (10) días, abone a la parte actora las retroactividades aprobadas con más sus intereses a la fecha del efectivo pago, bajo apercibimiento de proceder a la traba de embargo ejecutivo sin más trámite.");
                    parrafos.push(`4.- Regular los honorarios de la representación letrada de la parte actora en la suma de $ ${honorariosParaTexto.umaspesos || '0'}, que representan la cantidad de ${honorariosParaTexto.umasequivalente || '0'} UMAS (Conf. arts. arts. 16, 20, 21, 22, 29 y 51 de la ley 27.423 y Res. SGA 36/2026), suma a la que deberá adicionarse el IVA en caso de corresponder.`);    
                    parrafos.push("Se hace saber que dicha regulación se discrimina de la siguiente forma: 50% por la labor desarrollada en esta incidencia y 50% por las tareas que posteriormente se desarrollen hasta la transferencia de las sumas que eventualmente se embarguen. Así, la percepción de este último porcentaje sólo podrá hacerse efectivo ante el desarrollo de dichas tareas.");
                    parrafos.push("5.- Costas a la demandada vencida.");    
                } else {
                    const intimacionTexto = fallecimiento.herederos ? 
                        "proceda a abonar a la parte actora las retroactividades aprobadas con más sus intereses a la fecha del efectivo pago" :
                        "proceda a reajustar el haber previsional conforme a la liquidación aprobada, y abone a la parte actora las retroactividades aprobadas con más sus intereses a la fecha del efectivo pago";
                    parrafos.push(`1.- Aprobar en cuanto ha lugar por derecho la liquidación presentada por la actora con fecha ${formatearFecha(fechas.liquidacion)}, quedando determinado el haber al ${formatearFecha(fechas.final)} en la suma de $ ${formatearMonto(montos.haber)} y las retroactividades en ${numeroALetras(montos.retroactivo)} ($ ${formatearMonto(montos.retroactivo)}) ($ ${formatearMonto(montos.capital)} + $ ${formatearMonto(montos.intereses)}).`);    
                    if (fallecimiento.herederos) {
                        parrafos.push("Las sumas aquí aprobadas deberán ser depositadas en el correspondiente sucesorio, en caso de incumplimiento serán transferidas al mismo.");
                    }
                    parrafos.push(`2.- Intimar a la demandada para que en el plazo de diez (10) días, ${intimacionTexto}, bajo apercibimiento de proceder a la traba de embargo ejecutivo sin más trámite.`);
                    parrafos.push(`3.- Regular los honorarios de la representación letrada de la parte actora en la suma de $ ${honorariosParaTexto.umaspesos || '0'}, que representan la cantidad de ${honorariosParaTexto.umasequivalente || '0'} UMAS (Conf. arts. arts. 16, 20, 21, 22, 29 y 51 de la ley 27.423 y Res. SGA 36/2026), suma a la que deberá adicionarse el IVA en caso de corresponder.`);
                    parrafos.push("Se hace saber que dicha regulación se discrimina de la siguiente forma: 50% por la labor desarrollada en esta incidencia y 50% por las tareas que posteriormente se desarrollen hasta la transferencia de las sumas que eventualmente se embarguen. Así, la percepción de este último porcentaje sólo podrá hacerse efectivo ante el desarrollo de dichas tareas.");
                    parrafos.push("4.- Costas a la demandada vencida.");    
                    parrafos.push("Notifíquese por Secretaría a las partes de forma electrónica.");
                }
                setGenerado(parrafos.join('\n\n'));
            };
            const copiarTexto = async () => {
                try {
                    await navigator.clipboard.writeText(generado);
                    alert('Texto copiado al portapapeles');
                } catch (err) {
                    alert('Error al copiar');
                }
            };
            return (
                <div className="max-w-5xl mx-auto p-6 bg-gray-50 min-h-screen">
                    <div className="bg-white rounded-xl shadow-lg p-8 space-y-8">
                        <div className="border-b-2 border-blue-500 pb-4">
                            <h1 className="text-2xl font-bold text-gray-800">Generador de Sentencia ACT + INT / Integrales</h1>
                            <p className="text-sm text-gray-600 mt-1">Complete los campos y genere el texto automáticamente</p>
                        </div>
                        
                        {calculandoHonorarios && (
                            <div className="bg-blue-100 border-l-4 border-blue-500 text-blue-800 px-4 py-3 rounded-lg shadow-sm flex items-center">
                                <svg className="animate-spin h-5 w-5 mr-3 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <span className="font-medium">Calculando honorarios automáticamente...</span>
                            </div>
                        )}
                        
                        <div className="flex justify-start">
                            <button
                                type="button"
                                onClick={() => {
                                    const next = !modoNumerosALetras;
                                    setModoNumerosALetras(next);
                                    if (!next) setMostrarHonorariosEnModoLetras(false);
                                }}
                                className={`px-4 py-2 font-medium rounded-lg border transition-colors ${modoNumerosALetras ? 'bg-amber-100 border-amber-400 text-amber-800 hover:bg-amber-200' : 'bg-gray-200 border-gray-400 text-gray-800 hover:bg-gray-300'}`}
                            >
                                {modoNumerosALetras ? '← Volver al formulario completo' : 'Números a letras'}
                            </button>
                        </div>
                        {modoNumerosALetras && (
                            <p className="text-sm text-gray-600 -mt-2">Solo conversor de montos a letras y cálculo de honorarios.</p>
                        )}
                        
                        {!modoNumerosALetras && (
                        <section className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <h2 className="font-bold mb-3 text-lg text-gray-800">Estado del Actor</h2>
                            <div className="grid grid-cols-2 gap-4">
                                <label className="flex items-center cursor-pointer hover:bg-white p-2 rounded transition-colors gap-2">
                                    <input 
                                        type="checkbox"
                                        className="w-4 h-4 cursor-pointer flex-shrink-0"
                                        checked={fallecimiento.pensionada}
                                        onChange={e => setFallecimiento({pensionada: e.target.checked, herederos: false})}
                                    />
                                    <span className="text-gray-700 text-base">Fallecido con pensionada</span>
                                </label>
                                <label className="flex items-center cursor-pointer hover:bg-white p-2 rounded transition-colors gap-2">
                                    <input 
                                        type="checkbox"
                                        className="w-4 h-4 cursor-pointer flex-shrink-0"
                                        checked={fallecimiento.herederos}
                                        onChange={e => setFallecimiento({pensionada: false, herederos: e.target.checked})}
                                    />
                                    <span className="text-gray-700 text-base">Fallecido con herederos</span>
                                </label>
                            </div>
                        </section>
                        )}
                        {!modoNumerosALetras && (
                        <section className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <h2 className="font-bold mb-3 text-lg text-gray-800">Integrales</h2>
                            <div className="grid grid-cols-2 gap-4">
                                <label className="flex items-center cursor-pointer hover:bg-white p-2 rounded transition-colors gap-2">
                                    <input 
                                        type="checkbox"
                                        className="w-4 h-4 cursor-pointer flex-shrink-0"
                                        checked={integral.ansesreajusta}
                                        onChange={e => setIntegral({ansesreajusta: e.target.checked, ansespagaretroactivo: false, nohaypagonireajuste: false})}
                                    />
                                    <span className="text-gray-700 text-base">Anses reajusta haber</span>
                                </label>
                                <label className="flex items-center cursor-pointer hover:bg-white p-2 rounded transition-colors gap-2">
                                    <input 
                                        type="checkbox"
                                        className="w-4 h-4 cursor-pointer flex-shrink-0"
                                        checked={integral.ansespagaretroactivo}
                                        onChange={e => setIntegral({ansesreajusta: false, ansespagaretroactivo: e.target.checked, nohaypagonireajuste: false})}
                                    />
                                    <span className="text-gray-700 text-base">Anses paga retroactivo</span>
                                </label>
                                <label className="flex items-center cursor-pointer hover:bg-white p-2 rounded transition-colors gap-2">
                                    <input 
                                        type="checkbox"
                                        className="w-4 h-4 cursor-pointer flex-shrink-0"
                                        checked={integral.nohaypagonireajuste}
                                        onChange={e => setIntegral({ansesreajusta: false, ansespagaretroactivo: false, nohaypagonireajuste: e.target.checked})}
                                    />
                                    <span className="text-gray-700 text-base">No hay reajuste ni pago retroactivo</span>
                                </label>
                            </div>
                        </section>
                        )}
                        <section className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <h2 className="font-bold mb-3 text-lg text-gray-800">Fechas</h2>
                            <div className={modoNumerosALetras ? "grid grid-cols-1 gap-4" : "grid grid-cols-3 gap-4"}>
                                {!modoNumerosALetras && (
                                <div>
                                    <label className="block mb-1 text-base">Fecha de inicio</label>
                                    <input
                                        type="date"
                                        className="w-full p-2 border rounded"
                                        value={fechas.inicio}
                                        onChange={e => handleFechaChange(e, 'inicio')}
                                    />
                                </div>
                                )}
                                <div>
                                    <label className="block mb-1 text-base">Fecha final</label>
                                    <input
                                        type="date"
                                        className="w-full p-2 border rounded"
                                        value={fechas.final}
                                        onChange={e => handleFechaChange(e, 'final')}
                                    />
                                </div>
                                {!modoNumerosALetras && (
                                <div>
                                    <label className="block mb-1 text-base">Fecha de liquidación</label>
                                    <input
                                        type="date"
                                        className="w-full p-2 border rounded"
                                        value={fechas.liquidacion}
                                        onChange={e => handleFechaChange(e, 'liquidacion')}
                                    />
                                </div>
                                )}
                            </div>
                        </section>
                        <section className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <h2 className="font-bold mb-3 text-lg text-gray-800">Montos</h2>
                            <div className="grid grid-cols-2 gap-4">
                                {(modoNumerosALetras
                                    ? [['retroactivo', 'Retroactivo'], ['capital', 'Capital'], ['intereses', 'Intereses']]
                                    : [
                                        ['haber', 'Haber'],
                                        ['retroactivo', 'Retroactivo'],
                                        ['capital', 'Capital'],
                                        ['intereses', 'Intereses']
                                    ]
                                ).map(([key, label]) => (
                                    <div key={key}>
                                        <label className="block mb-1 text-base">{label}</label>
                                        <input
                                            type="text"
                                            className="w-full p-2 border rounded"
                                            value={montos[key]}
                                            onChange={e => handleMontoChange(e, key)}
                                            placeholder="0,00"
                                        />
                                    </div>
                                ))}
                                {!modoNumerosALetras && integral.ansesreajusta && (
                                    <div className="col-span-2">
                                        <label className="block mb-1 text-base">Mensual de pago</label>
                                        <input
                                            type="text"
                                            className="w-full p-2 border rounded"
                                            value={montos.mensualDePago}
                                            onChange={e => setMontos(prev => ({ ...prev, mensualDePago: e.target.value }))}
                                            placeholder="Ej: 08/2023"
                                        />
                                    </div>
                                )}
                            </div>
                        </section>
                        {modoNumerosALetras && !mostrarHonorariosEnModoLetras && (
                            <div>
                                <button
                                    type="button"
                                    onClick={() => setMostrarHonorariosEnModoLetras(true)}
                                    className="px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-800 font-medium rounded-lg border border-purple-300 transition-colors"
                                >
                                    Honorarios
                                </button>
                            </div>
                        )}
                        {(!modoNumerosALetras || mostrarHonorariosEnModoLetras) && (
                        <section className="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg border border-purple-200">
                            {modoNumerosALetras ? (
                                <div className="flex items-center justify-between mb-3">
                                    <h2 className="font-bold text-lg text-gray-800">Honorarios</h2>
                                    <button
                                        type="button"
                                        onClick={() => setMostrarHonorariosEnModoLetras(false)}
                                        className="text-sm text-gray-600 hover:text-gray-800 underline"
                                    >
                                        Ocultar
                                    </button>
                                </div>
                            ) : (
                                <h2 className="font-bold mb-3 text-lg text-gray-800">Honorarios</h2>
                            )}
                            <div className="bg-blue-50 border-l-4 border-blue-400 p-3 rounded mb-4">
                                <p className="text-sm text-blue-900">
                                    {modoNumerosALetras ? (
                                        <><strong>💡 Nota:</strong> Si completas "Fecha final" y "Retroactivo", al hacer clic en "Ver montos en letras" se calcularán los honorarios y se mostrarán en el resultado. Si no ingresas fecha final, no se calcularán honorarios y no aparecerán en el cuadro.</>
                                    ) : (
                                        <><strong>💡 Nota:</strong> Si los campos están <strong>vacíos</strong>, los honorarios se calcularán <strong>automáticamente</strong> al generar el texto usando el "Retroactivo" y la "Fecha final". Si completas los campos manualmente, se usarán esos valores. La fecha de regulación (J12, para C10) se usa automáticamente como la fecha actual del día (hoy).</>
                                    )}
                                </p>
                            </div>
                            {umaActual && (
                                <div className="bg-green-50 border border-green-300 p-2 rounded mb-3 shadow-sm">
                                    <p className="text-sm text-green-900 font-medium">
                                        <strong>✓ UMA ACTUAL (C10):</strong> ${formatearMonto(umaActual.toString())}
                                    </p>
                                </div>
                            )}
                            <div className="grid grid-cols-2 gap-4">
                                {[
                                    ['umaspesos', 'UMAs en Pesos'],
                                    ['umasequivalente', 'Cantidad de UMAs']
                                ].map(([key, label]) => {
                                    const isEmpty = !honorarios[key] || honorarios[key].trim() === '';
                                    return (
                                        <div key={key} className="bg-white p-3 rounded-lg border-2 shadow-sm" style={{borderColor: isEmpty ? '#d1d5db' : '#3b82f6'}}>
                                            <label className="block mb-2 font-semibold text-gray-700 text-base">{label}</label>
                                            <input
                                                type="text"
                                                className={`w-full p-3 border-2 rounded-lg transition-all ${isEmpty ? 'bg-gray-50 border-gray-300 placeholder-gray-400' : 'bg-blue-50 border-blue-400'}`}
                                                value={honorarios[key]}
                                                onChange={e => handleHonorariosChange(e, key)}
                                                placeholder={isEmpty ? "Vacío - se calculará automáticamente" : "0,00"}
                                                style={{fontSize: '14px'}}
                                            />
                                            {isEmpty && (
                                                <p className="text-xs text-gray-500 mt-1">Se calculará automáticamente</p>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                            <div className="mt-3">
                                <button
                                    type="button"
                                    onClick={() => setHonorarios({ umaspesos: '', umasequivalente: '' })}
                                    className="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-lg border border-gray-400 transition-colors"
                                >
                                    Limpiar honorarios
                                </button>
                            </div>
                        </section>
                        )}
                        {!modoNumerosALetras && (
                        <section className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <h2 className="font-bold mb-3 text-lg text-gray-800">Tipo de Interés</h2>
                            <div className="grid grid-cols-2 gap-4">
                                {[
                                    ['corteEmbargo', 'Desde corte hasta embargo'],
                                    ['corteTransferencia', 'Desde corte hasta transferencia'],
                                    ['intimacionEmbargo', 'Desde intimación hasta embargo'],
                                    ['intimacionTransferencia', 'Desde intimación hasta transferencia']
                                ].map(([id, label]) => (
                                    <label key={id} className="flex items-center cursor-pointer hover:bg-white p-2 rounded transition-colors gap-2">
                                        <input 
                                            type="checkbox"
                                            className="w-4 h-4 cursor-pointer flex-shrink-0"
                                            checked={tipoInteres === id}
                                            onChange={e => e.target.checked ? setTipoInteres(id) : setTipoInteres('')}
                                        />
                                        <span className="text-gray-700 text-base">{label}</span>
                                    </label>
                                ))}
                            </div>
                        </section>
                        )}
                        {!modoNumerosALetras && (
                        <section className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <h2 className="font-bold mb-3 text-lg text-gray-800">Impugnaciones ANSES</h2>
                            <div className="mb-4">
                                <label className="flex items-center cursor-pointer hover:bg-white p-2 rounded transition-colors gap-2">
                                    <input 
                                        type="checkbox"
                                        className="w-4 h-4 cursor-pointer flex-shrink-0"
                                        checked={ansesImpugno}
                                        onChange={e => setAnsesImpugno(e.target.checked)}
                                    />
                                    <span className="text-gray-700 text-base font-medium">ANSES impugnó la liquidación</span>
                                </label>
                            </div>
                            {ansesImpugno && (
                                <div className="pl-6 space-y-2">
                                    <div className="grid grid-cols-2 gap-4">
                                        {[
                                            ['a', 'Fechas incorrectas'],
                                            ['b', 'Movilidad Badaro'],
                                            ['c', 'Reajuste PBU'],
                                            ['d', 'Tasa de interés'],
                                            ['e', 'Haberes percibidos'],
                                            ['f', 'Forma de descontar pagos'],
                                            ['g', 'Topes legales'],
                                            ['h', 'Precedente Villanustre'],
                                            ['i', 'Impuesto a las Ganancias']
                                        ].map(([key, label]) => (
                                            <label key={key} className="flex items-center cursor-pointer hover:bg-white p-2 rounded transition-colors gap-2">
                                                <input 
                                                    type="checkbox"
                                                    className="w-4 h-4 cursor-pointer flex-shrink-0"
                                                    checked={impugnaciones[key]}
                                                    onChange={e => setImpugnaciones(prev => ({...prev, [key]: e.target.checked}))}
                                                />
                                                <span className="text-gray-700 text-base">{label}</span>
                                            </label>
                                        ))}
                                    </div>
                                </div>
                            )}
                            <div className="mt-4">
                                <label className="flex items-center cursor-pointer hover:bg-white p-2 rounded transition-colors gap-2">
                                    <input 
                                        type="checkbox"
                                        className="w-4 h-4 cursor-pointer flex-shrink-0"
                                        checked={ansesPresentoLiquidacion}
                                        onChange={e => setAnsesPresentoLiquidacion(e.target.checked)}
                                    />
                                    <span className="text-gray-700 text-base">ANSES presentó liquidación</span>
                                </label>
                            </div>
                        </section>
                        )}
                        <div className="flex justify-end space-x-4 pt-4 border-t border-gray-300">
                            <button
                                onClick={generarTexto}
                                className="px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold rounded-lg shadow-md hover:from-blue-700 hover:to-blue-800 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                            >
                                {modoNumerosALetras ? '🔢 Ver montos en letras' : '📝 Generar Texto'}
                            </button>
                            <button
                                onClick={copiarTexto}
                                disabled={!generado}
                                className="px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white font-semibold rounded-lg shadow-md hover:from-gray-700 hover:to-gray-800 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                            >
                                📋 Copiar Texto
                            </button>
                        </div>
                        {generado && (
                            <section className="mt-8 bg-white p-6 rounded-xl border-2 border-blue-200 shadow-lg">
                                <div className="flex items-center justify-between mb-4 pb-3 border-b-2 border-blue-300">
                                    <h2 className="font-bold text-xl text-gray-800">{modoNumerosALetras ? 'Montos en letras' : 'Vista Previa'}</h2>
                                    <span className="text-xs text-gray-500 bg-blue-50 px-3 py-1 rounded-full">{modoNumerosALetras ? 'Montos y honorarios' : 'Texto generado'}</span>
                                </div>
                                <div
                                    className="p-6 bg-gray-50 border-2 border-gray-200 rounded-lg whitespace-pre-wrap font-[Arial] text-[11px] leading-[1.5] text-justify shadow-inner max-h-96 overflow-y-auto"
                                    style={{textIndent: '1.27cm'}}
                                >
                                    {generado}
                                </div>
                            </section>
                        )}
                    </div>
                </div>
            );
        };
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<SentenciaGenerator />);
    </script>
</body>
</html>
